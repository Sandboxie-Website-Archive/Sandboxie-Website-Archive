<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="robots" content="index,follow">
	<meta name="language" content="en">
	<meta name="google-translate-customization" content="e0b0918ac010f34-ee72acc87a31fea6-gc7951f1948fb9449-11">
	<meta name="description" content="Sandboxie - Sandbox security software for Windows. Install and run programs in a virtual sandbox environment without writing to the hard drive.">
	<link rel="stylesheet" type="text/css" href="includes/style.css">
	<script type="text/javascript" src="../ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js">
	</script>
	<script type="text/javascript" src="includes/js/mobile-menu.js">
	</script>
	<script type="text/javascript">
var onload_reposition_ie = 0;
	</script>

<!--[if IE]>
<script type="text/javascript">
onload_reposition_ie = 1;
</script>
<![endif]-->

	<script type="text/javascript">
function onload_reposition()
{
}
	</script>

	<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','../www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-15566261-2', 'auto');
ga('send', 'pageview');
	</script>

<title>Sandboxie - Sandboxie Trace</title>
<meta name="description" content="Sandboxie Trace - Sandboxie, sandbox security and secure web browsing software for Windows">
</head>
<body onload="onload_reposition()">
<a name="top"></a> 
<div id="masthead">
	<table class="masthead" width="100%" cellpadding="0" cellspacing="0" border="0">
		<tr>
			<td width="312" style="vertical-align:top;"><a href="index.html" title="Sandboxie.com"><img src="images/MastheadLogo.jpg" alt="" height="92" width="312"></a></td>
			<td><span id="motto"><i>Trust&nbsp;No&nbsp;Program</i></span></td>
		</tr>
	</table>
	<div id="submasthead">
		<div id="drop-nav">
			<ul>
				<li><a href="index.html">Home</a></li>
				<li><a href="HelpTopics.html">Help &amp; FAQ</a></li>
				<li><a href="https://forums.sandboxie.com/">Forum</a></li>
				<li><a href="DownloadSandboxie.html">Download</a></li>
				<li><a href="RegisterSandboxie.html">Buy</a>
				<ul>
					<li><a href="HomeUse.html">Home Use</a></li>
				</ul>
				</li>
				<li><a href="SiteSearch.html">Search</a></li>
				<li><a href="HowItWorks.html">How It Works</a></li>
			</ul>
		</div>
	</div>
</div>
<div class="container-menus">
	<div class="one-menus">
		<div id="google_translate_element">
		</div>

		<script type="text/javascript">
function googleTranslateElementInit() {
new google.translate.TranslateElement({pageLanguage: 'en', includedLanguages: 'ar,bg,cs,da,de,el,en,es,et,fi,fr,hr,hu,id,it,iw,jv,ko,mk,nl,pl,pt,ru,sk,sq,sv,tr,uk,zh-CN,zh-TW', layout: google.translate.TranslateElement.InlineLayout.HORIZONTAL, gaTrack: true, gaId: 'UA-53196810-1'}, 'google_translate_element');
}
		</script>

	</div>
	<div class="two-menus">
		<div id="nav-trigger">
			<span>Menu</span>
		</div>
		<div id="nav-mobile"> 
		<ul>
			<li><a href="index.html">Home</a></li>
			<li><a href="HelpTopics.html">Help &amp; FAQ</a></li>
			<li><a href="https://forums.sandboxie.com/">Forum</a></li>
			<li><a href="DownloadSandboxie.html">Download</a></li>
			<li><a href="RegisterSandboxie.html">Buy</a></li>
			<li><a href="SiteSearch.html">Search</a></li>
			<li><a href="HowItWorks.html">How It Works</a></li>
		</ul>
		</div> 
	</div>
</div><div id="wrapper">
	<h1 style="margin:0;padding-top:.5em">
		Sandboxie Trace 
	</h1>
	<table style="border: 1px solid #bba; background-color: #f7f8ff; padding: 0px; font-size: 95%; text-align: left; width: 90%;">
		<tr>
			<td> 
			<p>
				<strong>The Sandboxie trace facility is deprecated. Please see <a href="ResourceAccessMonitor.html">Resource&nbsp;Access&nbsp;Monitor</a> for a more advanced solution.</strong>
			</p>
			</td>
		</tr>
	</table>
	<h3>
		Overview 
	</h3>
	<p>
		In some cases, a program may not function correctly within the sandbox, because it needs access to a system resource which is, by default, protected by Sandboxie, and access to that resource is denied. 
	</p>
	<p>
		Note that in this case, the sandboxed program is not creating the resource itself; rather, it expects the resource to already be available for access and use. 
	</p>
	<p>
		The trace displays access attempts and makes it possible to somewhat easily identify which resources that are needed for correct operation, have been blocked. 
	</p>
	<h3>
		Enable the Trace 
	</h3>
	<p>
		The trace is activated through four SandboxieIni settings: 
	</p>
	<ul>
		<li><strong>FileTrace</strong> logs access to files, folders, and filesystem volumes; 
		<li><strong>KeyTrace</strong> logs access to registry keys (but not values within keys); 
		<li><strong>PipeTrace</strong> logs access to named pipes and mail slot objects which are used for inter-process communication; 
		<li><strong>IpcTrace</strong> logs access to other objects used for inter-process communication, and also logs access attempts by one process to another process; 
		<li><strong>GuiTrace</strong> logs window-to-window communications, Windows hooks, and manufacturing of fake keyboard input. 
		<li><strong>ClsidTrace</strong> logs COM communications. 
	</ul>
	<p>
		Each setting accepts a sequence of characters which specifies what to log. The character <em>a</em> logs requests which were allowed; the character <em>d</em> logs requests which were denied. For the <strong>FileTrace</strong> and <strong>PipeTrace</strong> settings, the character <em>i</em> logs requests which were allowed because they access a device which is ignored by Sandboxie, such as a CD ROM. 
	</p>
	<p>
		The last three settings, <strong>PipeTrace</strong>, <strong>IpcTrace</strong> and <strong>GuiTrace</strong>, are more relevant to the discussion in this page. <strong>FileTrace</strong> and __KeyTrace_ will usually not be able to provide insight as to why a sandboxed program is malfunctioning. 
	</p>
	<p>
		Thus, typically you enable by the trace by making this change in SandboxieIni: 
	</p>
<pre>
   [GlobalSettings]
   IpcTrace=ad
   PipeTrace=ad
   GuiTrace=ad
	</pre>
	<p>
		Then use Sandboxie Control to reload the configuration. 
	</p>
	<h3>
		Review the Trace for <strong>IpcTrace</strong> and <strong>PipeTrace</strong> 
	</h3>
	<p>
		The information collected by the Sandboxie trace facility is logged in the system debugger log. You will need a utility to display this log: <a href="http://technet.microsoft.com/en-us/sysinternals/bb896647">DebugView</a> from Sysinternals (now Microsoft) is recommended. 
	</p>
	<p>
		(On Windows Vista, output from the system debugger log is disabled by default. <a href="http://blogs.msdn.com/doronh/archive/2006/11/14/where-did-my-debug-output-go-in-vista.aspx">This blog post</a> explains how to enable the output.) 
	</p>
	<p>
		The trace will display output in the following format. (Assuming <strong>IpcTrace</strong>, and <strong>PipeTrace</strong> enabled.) 
	</p>
	<p>
		...<br>
		(001404) SBIE (FA) 00120116.01.00000000 \Device\NamedPipe\ShimViewer<br>
		...<br>
		(001404) SBIE (IA) 001F0001 \ThemeApiPort<br>
		...<br>
		(001404) SBIE (PD) 00000040 001136<br>
		(001404) SBIE (PA) 00020400 001136<br>
		...<br>
		(001404) SBIE (FA) 00000001.0F.FFFFFFFF \Device\Afd\Endpoint<br>
		(001404) SBIE (FA) 00000001.0F.FFFFFFFF \Device\Afd<br>
		...<br>
		(001404) SBIE (ID) 001F0001 \RPC Control\protected_storage<br>
		...<br>
	</p>
	<p>
		The format is this: 
	</p>
	<p>
		(pid) SBIE (ca) (access) (resource) 
	</p>
	<p>
		where <em>pid</em> identifies the process attempting the access;<br>
		<em>c</em> indicates the Sandboxie class for the resource -- more on this later;<br>
		<em>a</em> indicates if the access was allowed (A) or denied (D);<br>
		access indicates the access requested to the object, and is typically not interesting or important;<br>
		<em>resource</em> identifies the resource to which access is desired; in the case of process-to-process access, where <em>ca</em> is (PA) or (PD), the resource name is the process id of the process being accessed. 
	</p>
	<p>
		Some examples: 
	</p>
	<p>
		(001404) SBIE (IA) 001F0001 \ThemeApiPort<br>
	</p>
	<p>
		Here the process making the request is process id 1404, and was allowed to access the resource named <em>ThemeApiPort</em>. The resource class is I, so this is an inter-process object. The access was allowed because by default, Sandboxie allows this specific access. 
	</p>
	<p>
		(001404) SBIE (ID) 001F0001 \RPC Control\protected_storage<br>
	</p>
	<p>
		Here the access to the resource <em>protected_storage</em> was denied. By default Sandboxie does not allow this access; however the OpenProtectedStorage setting changes this behavior. 
	</p>
	<p>
		(001404) SBIE (FA) 00000001.0F.FFFFFFFF \Device\Afd\Endpoint<br>
	</p>
	<p>
		Here the access is allowed to the resource <em>Endpoint</em>. The resource class is F, so this is a named pipe or a mail slot resource. The access is allowed by default, because the <em>\Device\Afd</em> prefix names resources needed for Internet access. 
	</p>
	<h3>
		Review <strong>GuiTrace</strong> Entries 
	</h3>
	<p>
		When <strong>GuiTrace</strong> is enabled, the trace also produces entires like the following. 
	</p>
	<p>
		...<br>
		(001404) SBIE (GA) WinHook 0002 on tid=001484 pid=001960<br>
		(001404) SBIE (GA) AccHook on tid=000000 pid=000000<br>
		...<br>
		(001404) SBIE (GD) PostMessage 01224 (04C8) to hwnd=00050060 pid=001324 DDEMLMom<br>
		(001404) SBIE (GD) SendMessage 49376 (C0E0) to hwnd=00010014 pid=000804 #32769<br>
		...<br>
		(001404) SBIE (GD) SendInput<br>
		(001404) SBIE (GA) SendInput<br>
	</p>
	<p>
		These entries have a few formats. The first word after (GA) or (GD) identifies the type of the entry. 
	</p>
	<p>
		When the first word is <em>WinHook</em> or <em>AccHook</em>, the entry indicates installation of a hook. Its installation is permitted for (GA) entries, and denied for (GD) entries. <em>WinHook</em> is a standard Windows hook, followed by the type of the hook (see <a href="http://www.google.com/search?hl=en&amp;q=setwindowshookex+msdn">SetWidowsHookEx in MSDN</a>). <em>AccHook</em> is an accessability hook (see <a href="http://www.google.com/search?hl=en&amp;q=setwineventhook+msdn">SetWinEventHook in MSDN</a>). 
	</p>
	<p>
		Both entries identify the thread number (tid) process number (pid) into which the hook was to be installed. 
	</p>
	<p>
		When the first word is <em>PostMessage</em>, <em>SendMessage</em> or <em>ThrdMessage</em>, the entry shows denied window communication. The following two numbers indicate the window message number, in decimal and hexadecimal. The entry also indicates the window handle (hwnd) of the target window, the process number (pid) which owns this window, and finally, the internal window class name for the window. 
	</p>
	<h3>
		Analyze the Trace 
	</h3>
	<p>
		The point of using the trace is usually to identify the resource that is keeping the sandboxed program from functioning correctly. 
	</p>
	<p>
		Consider for example the following trace record. 
	</p>
	<p>
		(001404) SBIE (ID) 001F0001 \BaseNamedObjects\Xyzzy<br>
	</p>
	<p>
		This shows that access to some <em>Xyzzy</em> resource was denied. Sandboxie does not know this resource, and by default, it denies access to unknown resources. 
	</p>
	<p>
		If a sandboxed programs begins to malfunction (it may lock up, or it may end abruptly, or just complain about something) soon after this record appears in the trace, it stands to reason that the program was expecting the resource to be accessible. 
	</p>
	<p>
		The next step is to add an <a href="OpenIpcPath.html">OpenIpcPath</a> setting for this resource:<br>
	</p>
	<p>
		OpenIpcPath=\BaseNamedObjects\Xyzzy 
	</p>
	<p>
		This setting tells Sandboxie that access to the <em>Xyzzy</em> resource should not be blocked. 
	</p>
	<p>
		Then reload the Sandboxie configuration, clear the old contents of the trace display, and restart the sandboxed program. If the program now performs better, <em>Xyzzy</em> was indeed the problematic resource. 
	</p>
	<p>
		But if the program still fails, the trace log can be inspected again for later (or possibly earlier) failed access attempts. 
	</p>
	<h3>
		Resource Class 
	</h3>
	<p>
		The trace record shows the Sandboxie resource class of the object. This indicates which OpenXxxPath setting is needed to allow access to the object. 
	</p>
	<ul>
		<li> When resource class is F, as in (FA) or (FD), the relevant settings are <a href="OpenFilePath.html">OpenFilePath</a> and <a href="ClosedFilePath.html">ClosedFilePath</a>
		<li> When resource class is K, as in (KA) or (KD), the relevant settings are <a href="OpenKeyPath.html">OpenKeyPath</a> and <a href="ClosedKeyPath.html">ClosedKeyPath</a>
		<li> When resource class is I, as in (IA) or (ID), the relevant settings are <a href="OpenIpcPath.html">OpenIpcPath</a> and <a href="ClosedIpcPath.html">ClosedIpcPath</a>
		<li> When resource class is G, as in (GA) or (GD), the relevant settings are <a href="OpenWinClass.html">OpenWinClass</a>, <a href="BlockWinHooks.html">BlockWinHooks</a>, and <a href="BlockFakeInput.html">BlockFakeInput</a>
		<li> For COM objects displayed by ClsidTrace, the relevant setting is <a href="OpenClsid.html">OpenClsid</a>.
	</ul>
</div>

<p align="center" style="font-size:8pt; line-height:1.4em;">
	<b>Sandboxie</b> is Copyright &copy; 2004-2019 by Sandboxie Holdings, LLC.&nbsp; All rights reserved. <br>
	<b><a href="index.html">Sandboxie.com</a> | <a href="ContactAuthor.html">Contact Author</a></b> <br>
</p>

<script type="text/javascript" src="../translate.google.com/translate_a/elementa0d8.html?cb=googleTranslateElementInit"></script>
</body>
</html>
